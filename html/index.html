<!doctype html>
<html>
  <head>
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

  <title>Mini Prover</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="style.css" />

  <script src="https://code.jquery.com/jquery-3.4.1.js"
          integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
          crossorigin="anonymous"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous"></script>

  <script src="jsprover.js"></script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: [
        "mml2jax.js"
      ],

      CommonHTML: {
        scale: 200
      },

      showMathMenu: false,

      "fast-preview": { disabled: true },
      tex2jax: { preview: "none" },
      mml2jax: { preview: "none" },
      tex2jax: { preview: "none" },
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"
          integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0="
          crossorigin="anonymous"></script>

  <script type="text/javascript">
    var goal = null;

    function string_of_goal(goal) {
      var aout = "";
      var subgoals = goal.subgoals();

      aout += "Goals count: " + subgoals.length + "\n";

      for (var i = 0; i < subgoals.length; ++i) {
        if (i == 0) {
          var sg   = subgoals[i];
          var hyps = sg.context();


          aout += "\n";
          aout += "Variables: " + subgoals[i].vars().join(", ") + "\n";
          aout += "\n";

          for (var j = 0; j < hyps.length; ++j) {
            aout += "H[" + j.toString().padStart(4, '0')
                      + "]: " + hyps[j].form.tostring() + "\n";
          }

          aout += "=".repeat(68) + "\n";
          aout += sg.conclusion().tostring();
          aout += "\n\n";
        } else {
          aout += "Goal " + (i+1) + ": " + subgoals[i].conclusion().tostring() + "\n";
        }
      }

      return aout;
    }

    $(function() {
      $("#parse").click(function() {
        var input = $("#formulaInput").val().trim();

        $("#playground").empty();
        $("#formulaInput").focus().select();

        var action = undefined;

        try {
          if (input == "reset") {
            goal = null;
          } else if (input == "intro") {
            if (goal != null && !goal.closed()) {
               goal = goal.subgoals()[0].intro(0);
               $("#log").append("intro\n")
            }
          } else if ((m = /^intro\s+(\d+)$/.exec(input))) {
            if (goal != null && !goal.closed()) {
               idx  = parseInt(m[1]);
               goal = goal.subgoals()[0].intro(idx);
               $("#log").append("intro " + idx + "\n")
            }
          } else if ((m = /^elim\s+(\d+)$/.exec(input))) {
            if (goal != null && !goal.closed()) {
               idx    = parseInt(m[1])
               target = goal.subgoals()[0].context()[idx];
               if (target !== undefined) {
                 goal = goal.subgoals()[0].elim(target);
                 $("#log").append("elim " + idx + "\n")
               }
            }
          } else {
            goal = engine.parse(input);
            $("#log").empty();
          }
        } catch(error) {
          // Have to use proper exceptions in the OCaml API
          if (!(Array.isArray(error)))
            throw error;
          $("#playground").empty().append(
            $("<div class='alert alert-danger' role='alert'>").text(error)
          );
        }

        if (goal != null) {
          $("#playground").append($("<pre><code>").text(string_of_goal(goal)));
        } else {
          $("#log").empty();
        }
      });

      $("form:not(.filter) :input:visible:enabled:first").focus();
    });
  </script>
</head>

<body>
  <div class="jumbotron text-center">
    <h1>Mini Prover</h1>
  </div>

  <div class="container">
    <div class="row">
      <form class="form-inline" action="javascript:false">
        <div class="form-group">
          <label for="formulaInput">Goal / Action</label>
          <input type="text" class="form-control" id="formulaInput" size="40"
                 value="A, B |- (~~A || ~~B) -> ~~(A && B)">
        </div>
        <button type="submit" class="btn btn-default" id="parse">Start</button>
      </form>
    </div>

    <h4>Goals</h4>

    <div id="playground"></div>

    <h4>Actions log</h4>

    <pre class="log"><code><div id="log"></div></code></pre>

    <div class="alert alert-info">
      <strong>
        Default goal can be solved with the following script
      </strong>

<pre><code>
intro
intro
elim 0
elim 1
elim 0
elim 0
elim 1
elim 0
elim 1
</code></pre>
    </div>

  </div>
</body>
</html>
